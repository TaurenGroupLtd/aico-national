<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyC_xom-ewAlhBrLsyxG8CkvglZoGaXPxyE" async defer></script>
<script src="//cdn.rawgit.com/mahnunchik/markerclustererplus/master/dist/markerclusterer.min.js"></script>
<script src='//cdn.rawgit.com/printercu/google-maps-utility-library-v3-read-only/master/infobox/src/infobox_packed.js' type='text/javascript'></script>

<div class="row">
  <div class="col-sm-12 hidden-md-down">
    <div class="locationsMapDiv">
      <div id="map" class="locationsMap"></div>
    </div>
  </div>
</div>
<br>
<% if user_signed_in? %>
<table>
  <thead>
    <tr>
      <th>Unit number</th>
      <th>Street number</th>
      <th>Street name</th>
      <th>Quad</th>
      <th>City</th>
      <th>Province</th>
      <th>Postal code</th>
      <th>Local tel</th>
      <th>Toll free</th>
      <th>New build</th>
      <th>Exteriors</th>
      <th>General contracting</th>
      <th>Flood</th>
      <th>Water</th>
      <th>Asbestos</th>
      <th>Wind hail</th>
      <th>Biohazard</th>
      <th>Grow op</th>
      <th colspan="3"></th>
    </tr>
  </thead>

  <tbody>
    <% @locations.each do |location| %>
      <tr>
        <td><%= location.unit_number %></td>
        <td><%= location.street_number %></td>
        <td><%= location.street_name %></td>
        <td><%= location.quad %></td>
        <td><%= location.city %></td>
        <td><%= location.province %></td>
        <td><%= location.postal_code %></td>
        <td><%= location.local_tel %></td>
        <td><%= location.toll_free %></td>
        <td><%= location.new_build %></td>
        <td><%= location.exteriors %></td>
        <td><%= location.general_contracting %></td>
        <td><%= location.flood %></td>
        <td><%= location.water %></td>
        <td><%= location.asbestos %></td>
        <td><%= location.wind_hail %></td>
        <td><%= location.biohazard %></td>
        <td><%= location.grow_op %></td>
        <td><%= link_to 'Show', location %></td>
        <td><%= link_to 'Edit', edit_location_path(location) %></td>
        <td><%= link_to 'Destroy', location, method: :delete, data: { confirm: 'Are you sure?' } %></td>
      </tr>
    <% end %>
  </tbody>
</table>

<br>

<%= link_to 'New Location', new_location_path %>
<% else %>
  <div class="row locationsContainer">
    <div class="col-sm-6">
      <center><h3>AICO Locations</h3></center>
      <br>
      <div class="row">
      <% @locations.each do |location| %>
        <div class="col-sm-12">
          <div class="card">
            <div class="card-block">
              <center><h5><%= location.city %> <%= location.province %></h5></center>
              <center><p class="locationCard"><i class="fa fa-map-marker" aria-hidden="true"></i> <% if location.unit_number.present? %><%= location.unit_number %> - <% end %> <%= location.unit_number %> <%= location.street_name.upcase %> <%= location.quad.upcase %> <%= location.city %> <%= location.province %> <%= location.postal_code %></p></center>
              <center><p class="locationCard"><% if location.toll_free.present? %> <i class="fa fa-phone" aria-hidden="true"></i> 24/7: <%= location.toll_free %> | <% end %> <% if location.local_tel.present? %> Local: <%= location.local_tel %> <% end %></p></center>
              <center><p class="locationCard"><% if location.toll_free.present? %><%= link_to "Emergency", "tel:#{location.toll_free}", :class => 'btn btn-sm btn-outline-danger' %> <% end %> <%= link_to "Book Appointment", "tel:#{location.local_tel}", :class => 'btn btn-sm btn-outline-success' %></p></center>
              <center><p class="locationCard"><%= link_to 'View', location, :class => 'btn btn-sm btn-outline-primary viewLocation' %></p></center>
            </div>
          </div>
        </div>
      <% end %>
      </div>
    </div>
    <div class="col-sm-6">
      <center><h3>Contact Us!</h3></center>
      <center><p class="contactDisclaimer"><i>Please allow minimum 1 business day for us to contact you regarding your inquiry! Thank-you for your interest in AICO Construction inc.</i></p></center>
      <%= form_for @message, url: create_message_url do |f| %>
        <%= notice %>
        <%= @message.errors.full_messages.join(', ') %>
        <div class="row">
          <div class="col-sm-4">
            <div class="form-group">
              <label class="locationCard" for="name">Name*</label>
              <%= f.text_field :name, :class => 'form-control locationCard', :id => 'name', :placeholder => 'Steve Smith' %>
            </div>
          </div>
          <div class="col-sm-4">
            <div class="form-group">
              <label class="locationCard" for="email">Email*</label>
              <%= f.email_field :email, :class => 'form-control locationCard', :id => 'email', :placeholder => 'you@email.com' %>
            </div>
          </div>
          <div class="col-sm-4">
            <div class="form-group">
              <label class="locationCard" for="tel">Telephone</label>
              <%= f.text_field :tel, :class => 'form-control locationCard', :id => 'tel', :placeholder => '(403-123-4567)' %>
            </div>
          </div>
        </div>
        <div class="row">
          <div class="col-sm-3">

          </div>
          <div class="col-sm-6">
            <div class="form-group">
              <label class="locationCard" for="subject">Subject*</label>
              <%= f.email_field :subject, :class => 'form-control locationCard', :id => 'subject' %>
            </div>
          </div>
          <div class="col-sm-3">

          </div>
        </div>
        <div class="row">
          <div class="col-sm-12">
            <div class="form-group">
              <label class="locationCard" for="body">Body*</label>
              <%= f.email_field :body, :class => 'form-control locationCard textBody', :id => 'body' %>
            </div>
          </div>
        </div>
        <center><%= f.submit 'Send', :class => 'btn btn-sm btn btn-outline-success' %><center>
      <% end %>
    </div>
  </div>
<% end %>

<script type="text/javascript">
  handler = Gmaps.build('Google');
  handler.buildMap({ provider: {}, internal: {id: 'map'}}, function(){
    markers = handler.addMarkers(<%=raw @hash.to_json %>);
    handler.bounds.extendWith(markers);
    handler.fitMapToBounds();
  });
</script>
